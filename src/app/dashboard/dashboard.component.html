<div class="dashboard-container" *ngIf="!loading && !error">

  <header class="dashboard-header">
    <h2>Visão geral dos investimentos</h2>
  </header>

  
  <section class="summary-cards" aria-label="Resumo dos investimentos">
    <div class="card azul">
      <h3>Total investido</h3>
      <p>R$ {{ totalBalance | number: '1.2-2' }}</p>
    </div>

    <div class="card laranja" *ngIf="riskProfile">
      <h3>Perfil de risco</h3>
      <p>{{ riskProfile.level }}</p>
    </div>
  </section>


  <section class="charts-section" aria-label="Gráficos de investimento">
    <div class="charts-grid">
      <div class="chart-box">
        <h4>Distribuição por tipo</h4>
        <canvas
          baseChart
          [data]="pieChartData"
          chartType="pie">
        </canvas>
      </div>

      <div class="chart-box">
        <h4>Saldo por produto</h4>
        <canvas
          baseChart
          [data]="barChartData"
          [options]="barChartOptions"
          chartType="bar">
        </canvas>
      </div>

      <div class="chart-box">
        <h4>Evolução do investimento</h4>
        <canvas
          baseChart
          [data]="evolutionChartData"
          chartType="line">
        </canvas>
      </div>

      <div class="chart-box">
        <h4>Histórico de score de risco</h4>
        <canvas
          baseChart
          [data]="riskHistoryChartData"
          chartType="line">
        </canvas>
      </div>
    </div>
  </section>


  <section
    class="recommended-section"
    *ngIf="recommendedProducts?.length"
    aria-label="Produtos recomendados">
    <h3>Produtos recomendados para você</h3>

    <div class="recommended-list">
      <div class="product" *ngFor="let p of recommendedProducts">
        <h4>{{ p.name }}</h4>
        <p>Tipo: {{ p.type }}</p>
        <p>
          Rentabilidade:
          {{ p.profitability * 100 | number: '1.2-2' }}% a.a.
        </p>
        <p>Perfil alvo: {{ p.riskLevel }}</p>

        <button type="button" (click)="onSimulate(p)">
          Simular
        </button>
      </div>
    </div>
  </section>
</div>
 
<section class="simulator-card">
  <h2>Simulador de investimento</h2>

  <form
    class="sim-form"
    (ngSubmit)="calcularSimulacao()">

    <mat-form-field appearance="outline" class="sim-field">
      <mat-label>Valor a investir (R$)</mat-label>
      <input
        matInput
        type="number"
        min="0"
        name="simValor"
        [(ngModel)]="simValor"
        required>
    </mat-form-field>

    <mat-form-field appearance="outline" class="sim-field">
      <mat-label>Prazo (meses)</mat-label>
      <input
        matInput
        type="number"
        min="1"
        name="simPrazoMeses"
        [(ngModel)]="simPrazoMeses"
        required>
    </mat-form-field>

    <mat-form-field appearance="outline" class="sim-field">
      <mat-label>Tipo de produto</mat-label>
      <mat-select
        name="simTipo"
        [(ngModel)]="simTipo">
        <mat-option
          *ngFor="let t of simTipos"
          [value]="t">
          {{ t }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <button
      mat-raised-button
      color="primary"
      type="submit"
      class="sim-button">
      Simular
    </button>
  </form>

  <div
    class="sim-result"
    *ngIf="simResultadoBruto !== null">
    <p>
      Valor aplicado:
      <strong>{{ simValor | currency:'BRL':'symbol':'1.2-2' }}</strong>
    </p>
    <p>
      Valor estimado ao final de {{ simPrazoMeses }} meses:
      <strong>{{ simResultadoBruto | currency:'BRL':'symbol':'1.2-2' }}</strong>
    </p>
    <p>
      Ganho estimado no período:
      <strong>{{ simGanho | currency:'BRL':'symbol':'1.2-2' }}</strong>
    </p>
    <p class="sim-disclaimer">
      *Simulação simplificada com juros compostos mensais e taxa anual
      aproximada por tipo de produto. Não substitui a simulação oficial da CAIXA.
    </p>
  </div>
</section>


<div *ngIf="loading" class="loading">
  Carregando dados...
</div>

<div *ngIf="error" class="error">
  {{ error }}
</div>
